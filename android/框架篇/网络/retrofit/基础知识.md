[炒鸡棒的Retrofit2原理分析](https://juejin.im/post/5a9f36acf265da23a1416cb6)
### Retrofit2介绍
retrofit是一个RESTFUL 的http网络请求框架。
通过builder建造者模式来封装一系列网络请求的基础参数，如域名地址，网络执行器，响应数据转换器，结果回调器等。
然后通过外观模式retrofit.create(::class)以及内部的动态代理技术来创建代理接口对象。
然后通过适配器模式来根据接口定义方法返回值类型来选择网络执行器callAdapter，然后由方法以及方法的注解来解析得到ServiceMethod对象并缓存。
然后进一步得到网络请求对象request，通过之前得到的网络执行器callAdapter发起请求。服务端返回数据，根据策略模式（接口方法返回值的类型）得到数据转换器以及回调执行器（切换线程）将最后的结果返回给用户。



#### 涉及到的设计模式
1. 建造者模式
2. 工厂模式：
    - CallAdapter.Factory 和 Converer.Factory分别负责提供不同的功能模块
    - 工厂负责如何提供，以及提供什么功能模块。使得外部开发者不必关心如何提供对象，直接操作对象即可。
    - Retrofit只负责提供选择哪种工厂的决策信息（如网络接口方法的参数，返回值类型，注解）
    - 实现高内聚，低耦合
3. 外观模式
4. 动态代理模式： 
    - 好处
        - 对接口方法的调用，会统一转发到代理对象的invoke方法中，可以集中处理
        - 获得网络请求接口实例上的所有注解
        - 方便封装ServiceMethod，使得构建网络请求对象更抽象化
5. 适配器模式
6. 策略模式：
    - 根据网络接口方法定义的返回值类型来推导决策要使用具体哪种执行器，然后创建执行器实例对象。


#### 总结
Retrofit采用外观模式统一调用创建网络请求接口实例和网络请求参数配置的方法，具体细节是：
1. 动态创建网络请求接口的实例（动态代理模式 ）
2. 创建ServiceMethod对象（建造者模式 & 单例模式（缓存））
3. 对ServiceMethod对象进行网络请求参数配置：通过解析网络接口方法的参数，返回值以及注解类型，从Retrofit对象中获取对应的网络请求url地址，由（策略模式，适配器模式，工厂模式）选择并创建网络执行器call，callAdapter，convertor。
4. 对ServiceMethod对象加入线程切换的操作，便于接收数据后通过Handler从子线程切换到主线程；从而对数据结果
5. 最终创建并返回一个OkhttpCall类型的网络请求对象