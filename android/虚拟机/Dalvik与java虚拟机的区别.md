首先我们知道，android应用程序是运行在Dalvik虚拟机里面的，并且每一个应用程序对应一个单独的Dalvik虚拟机实例。除了指令集和类文件格式不同，Dalvik与java虚拟机共享有以下特性，例如它们都是解释执行，并且支持及时编译JIT，垃圾回收GC，Java方法的本地调用JNI和java远程调用协议JDWP等。
# Dalvik与java虚拟机
1. Dalvik
    - 类文件格式 dex。 一个dex可以包含多个类，并且dex可以将多个类中重复的字符串和其他常数只保存一次。节省空间
    - 指令集：基于寄存器的。基于寄存器的指令由于需要指定源地址和目标地址，因此需要占用更多的指令空间。例如其需要占用两个字节。缺点：需要更多的指令空间，意味着数据缓冲更容易失效。
    - 自身的优化点有：
        - 多个类文件收集到同一个dex文件中，以便节省空间；
        - 使用只读的内存映射方式加载dex文件，以便可以多进程共享dex文件，节省程序加载时间；
        - 前调整好字节序（byte order）和字对齐（word alignment）方式，使得它们更适合于本地机器，以便提高指令执行速度；
        - 尽量提前进行字节码验证（bytecode verification），提高程序的加载速度；
        - 需要重写字节码的优化要提前进行。

2. java虚拟机
    - 类文件格式 class。一个class只包括一个类。
    - 指令集：基于堆栈的。基于堆栈的指令很紧凑，例如其只占用一个字节，故而成为字节码。缺点：需要更多指令，也就意味着需要多占用cpu时间。
    - 指令集补充：基于堆栈的指令集更具可移植性。因为它不对目标机器的寄存器做更多假设。然后基于寄存器的指令集对目标机器的寄存器有要求。故而基于寄存器的，它更有利AOT优化。



# AOT与JIT
 所谓AOT，就是在解释语言程序运行之前，就先将它编译成本地机器语言程序。AOT本质上是一种静态编译，它是相对于JIT而言的，也就是说，前者是在程序运行前进行编译，而后者是在程序运行时进行编译。运行时编译意味着可以利用运行时信息来得到比较静态编译更优化的代码，同时也意味不能进行某些高级优化，因为优化过程太耗时了。另一方面，运行前编译由于不占用程序运行时间，因此，它就可以不计时间成本来优化代码。无论AOT，还是JIT，最终的目标都是将解释语言编译为本地机器语言，而本地机器语言都是基于寄存器来执行的，因此，在某种程度来讲，基于寄存器的指令更有利于进行AOT编译以及优化。
